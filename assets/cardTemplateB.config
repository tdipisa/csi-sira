<Panel
    bsStyle="primary"
    header={(
        <DetailTitle title='AUA - IMPIANTI RECUPERO ENERGIA E MATERIA' subtitle={[
            'N°',
            model.getValue("/wfs:FeatureCollection/wfs:member/sira:AutorizzazioneUnicaAmbientale/sira:istanza/sira:IstanzaAutorizzativa/sira:nrProvvedimento/text()"),
            'del',
            model.getValue("/wfs:FeatureCollection/wfs:member/sira:AutorizzazioneUnicaAmbientale/sira:istanza/sira:IstanzaAutorizzativa/sira:dataRilascio/text()")
            ]} id={model.id}/>
    )}>
    <Panel className="template">
        <Section header='DATI GENERALI - Provvedimento' eventKey='1' expanded={true}>
            <LabeledField label='Codice Fiscale (P.IVA)' value={
                model.getValue("/wfs:FeatureCollection/wfs:member/sira:AutorizzazioneUnicaAmbientale/sira:istanza/sira:IstanzaAutorizzativa/sira:codiceFiscale/text()")
            }/>
            <LabeledField label='Tipo di provvedimento' value={
                model.getValue({
                    xpath: [
                        "/wfs:FeatureCollection/wfs:member/sira:AutorizzazioneUnicaAmbientale/sira:istanza/sira:IstanzaAutorizzativa/sira:procedimento/sira:Procedimento/sira:descrizione/text()",
                        "/wfs:FeatureCollection/wfs:member/sira:AutorizzazioneUnicaAmbientale/sira:attivita/sira:Attivita/sira:descrizione/text()"
                    ],
                    type: 2
                })
            }/>
            <LabeledField label='Num. Autorizzazione' value={
                model.getValue("/wfs:FeatureCollection/wfs:member/sira:AutorizzazioneUnicaAmbientale/sira:istanza/sira:IstanzaAutorizzativa/sira:nrProvvedimento/text()")
            }/>
            <LabeledField label='Data autorizzazione' value={
                model.getValue("/wfs:FeatureCollection/wfs:member/sira:AutorizzazioneUnicaAmbientale/sira:istanza/sira:IstanzaAutorizzativa/sira:dataRilascio/text()")
            }/>
            <LabeledField label='Tipologie impiantistiche' value={
                model.getValue("/wfs:FeatureCollection/wfs:member/sira:AutorizzazioneUnicaAmbientale/sira:rifiuto/sira:Rifiuto/sira:impianto/sira:TipoImpianto/sira:descrizione/text()")
            }/>
            <LabeledField label='Quantità inviata al recupero totale (t/a)' value={
                model.getValue("/wfs:FeatureCollection/wfs:member/sira:AutorizzazioneUnicaAmbientale/sira:rifiuto/sira:Rifiuto/sira:qtaTotRecupero/text()")
            }/>
            <LabeledField label='Capacità massima stoccabile (t)'/>
            <LabeledField label='Capacità massima stoccabile (m3)'/>
            <LabeledField label='Note'/>
        </Section>
        <Section header='OGGETTI AUTORIZZATI' eventKey='3' expanded={true}>
            <AuthorizedObject
                list={model.getValue("/wfs:FeatureCollection/wfs:member/sira:AutorizzazioneUnicaAmbientale/sira:impianto/sira:Sede/sira:codiceSira/text()")}
                listTitle={"Impianto Autorizzato"}
                detailsTemplateConfigURL={"assets/impiantoAutorizzato.config"}/>
        </Section>
        <Section header='RIEPILOGO RECUPERO RIFIUTI' eventKey='2' expanded={true}>
            <SiraTable
                id="RecuperoRifiuti"
                columnDefs={
                    [
                        {
                            checkboxSelection: true,
                            width: 30,
                            headerName: '',
                            field: "id",
                            xpath: "sira:SchedaRifiuto/sira:tipoRifiuto/sira:TipoRifiuto/@gml:id"
                        },
                        {
                            headerName: 'Numero scheda',
                            width: 90,
                            field: 'numscheda',
                            xpath:"sira:SchedaRifiuto/sira:nrScheda/text()"
                        },
                        {
                            headerName: 'Tipo recupero',
                            width: 300,
                            field: 'tiporecupero',
                            xpath: "sira:SchedaRifiuto/sira:tipoRecupero/sira:TipoRecupero/sira:descrizione/text()"
                        },
                        {
                            headerName: 'Tipologia di rifiuto',
                            width: 100,
                            field: 'codice',
                            xpath: "sira:SchedaRifiuto/sira:tipoRifiuto/sira:TipoRifiuto/sira:codice/text()"
                        },
                        {
                            headerName: 'Descrizione',
                            width: 500,
                            field: 'descrizione',
                            xpath: "sira:SchedaRifiuto/sira:tipoRifiuto/sira:TipoRifiuto/sira:descrizione/text()"
                        }
                    ]
                }
                features={model.getValue("/wfs:FeatureCollection/wfs:member/sira:AutorizzazioneUnicaAmbientale/sira:rifiuto/sira:Rifiuto/sira:dettaglio")}/>
        </Section>
        <Section header='DETTAGLIO RECUPERO RIFIUTI - CODIFICHE CER' eventKey='4' expanded={( model.RecuperoRifiuti !== undefined && model.RecuperoRifiuti !== null ) ? true: false}>
            <SiraTable
                id="CerTable"
                rowSelection={false}
                columnDefs={[
                    {headerName: "Codice", width: 100, field: "codice"},
                    {headerName: "Tipo Pericoloso", width: 100, field: "tipo"},
                    {headerName: "Descrizione", width: 500, field: "descrizione"}
                ]}
                features={() => {
                    let features = model.getValue({
                        type: 4,
                        field: "dettagliorifiuto",
                        xpath: ["/wfs:FeatureCollection/wfs:member/sira:AutorizzazioneUnicaAmbientale/sira:rifiuto/sira:Rifiuto/sira:dettaglio"],
                        fields: [
                        {
                            field: "id",
                            xpath: ["sira:SchedaRifiuto/sira:tipoRifiuto/sira:TipoRifiuto/@gml:id"],
                            type: 2
                        },
                        {
                            type: 4,
                            field: "codiceCER",
                            xpath: ["sira:SchedaRifiuto/sira:codiceCER"],
                            fields: [
                            {
                                field: "codice",
                                xpath: ["sira:CodiceCER/sira:codice/text()"],
                                type: 2
                            },
                            {
                                field: "tipo",
                                xpath: ["sira:CodiceCER/sira:pericoloso/text()"],
                                type: 2
                            },
                            {
                                field: "descrizione",
                                xpath: ["sira:CodiceCER/sira:descrizione/text()"],
                                type: 2
                            }]
                        },
                        {
                            type: 4,
                            field: "opRecupero",
                            xpath: ["sira:SchedaRifiuto/sira:operazioneRecupero"],
                            fields: [
                            {
                                field: "codice",
                                xpath: ["sira:OperazioneRecupero/sira:codice/text()"],
                                type: 2
                            },
                            {
                                field: "descrizione",
                                xpath: ["sira:OperazioneRecupero/sira:descrizione/text()"],
                                type: 2
                            }]
                        }]
                    }) || [];

                    let filtredFeaturs = features.filter(function(value) {
                        return value.id === model.RecuperoRifiuti;
                    });
                    return (filtredFeaturs[0]) ? filtredFeaturs[0].codiceCER : []
                }}/>
        </Section>
        <Section header='DETTAGLIO RECUPERO RIFIUTI - OPERAZIONI DI RECUPERO' eventKey='5' expanded={( model.RecuperoRifiuti !== undefined && model.RecuperoRifiuti !== null ) ? true: false}>
            <SiraTable
                id="CerTable"
                rowSelection={false}
                columnDefs={[
                    {headerName: "Codice", width: 100, field: "codice"},
                    {headerName: "Descrizione", width: 500, field: "descrizione"}
                ]}
                features={() => {
                    let features = model.getValue({
                        type: 4,
                        field: "dettagliorifiuto",
                        xpath: ["/wfs:FeatureCollection/wfs:member/sira:AutorizzazioneUnicaAmbientale/sira:rifiuto/sira:Rifiuto/sira:dettaglio"],
                        fields: [
                        {
                            field: "id",
                            xpath: ["sira:SchedaRifiuto/sira:tipoRifiuto/sira:TipoRifiuto/@gml:id"],
                            type: 2
                        },
                        {
                            type: 4,
                            field: "codiceCER",
                            xpath: ["sira:SchedaRifiuto/sira:codiceCER"],
                            fields: [
                            {
                                field: "codice",
                                xpath: ["sira:CodiceCER/sira:codice/text()"],
                                type: 2
                            },
                            {
                                field: "tipo",
                                xpath: ["sira:CodiceCER/sira:pericoloso/text()"],
                                type: 2
                            },
                            {
                                field: "descrizione",
                                xpath: ["sira:CodiceCER/sira:descrizione/text()"],
                                type: 2
                            }]
                        },
                        {
                            type: 4,
                            field: "opRecupero",
                            xpath: ["sira:SchedaRifiuto/sira:operazioneRecupero"],
                            fields: [
                            {
                                field: "codice",
                                xpath: ["sira:OperazioneRecupero/sira:codice/text()"],
                                type: 2
                            },
                            {
                                field: "descrizione",
                                xpath: ["sira:OperazioneRecupero/sira:descrizione/text()"],
                                type: 2
                            }]
                        }
                        ]
                    }) || [];

                    let filtredFeaturs = features.filter(function(value) {
                        return value.id === model.RecuperoRifiuti;
                    });
                    return (filtredFeaturs[0]) ? filtredFeaturs[0].opRecupero : []
                }}/>
        </Section>
        <Section header='MAPPA SINTESI – IMPIANTO' eventKey='6' expanded={true}>
            <MappaScheda center={
                model.getValue({
                    type: TemplateUtils.GEOMETRY_TYPE,
                    xpath: "/wfs:FeatureCollection/wfs:member/sira:AutorizzazioneUnicaAmbientale/sira:impianto/sira:Sede/sira:geometria/gml:Point/gml:pos/text()"
                })
            } authParam={model.authParam}/>
        </Section>
        <Section header='METADATI' eventKey='7'>
            <LinkToPage txt="Visualizza la scheda dei metadati"
                url="http://www.geoportale.piemonte.it/geonetworkrp/srv/ita/metadata.show"
                params={{id: 2658 || model.getValue("/wfs:FeatureCollection/wfs:member/sira:AutorizzazioneUnicaAmbientale/sira:impianto/sira:Sede/sira:codiceSira/text()"), currTab: 'rndt'}} />
        </Section>
    </Panel>
</Panel>
